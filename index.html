
<!DOCTYPE html>
<html lang="es" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistemas 4A | Angel Rodriguez - Business eCard</title>

    <!-- Metadatos de Propiedad -->
    <meta name="author" content="Ing. Angel Rodriguez">
    <meta name="owner" content="Ing. Angel Rodriguez">

    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&family=Lexend:wght@400;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        's4a-navy': '#040712',
                        's4a-blue': '#3b82f6',
                        's4a-accent': '#10b981',
                        'glass': 'rgba(15, 23, 42, 0.8)',
                    },
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        display: ['Lexend', 'sans-serif'],
                    },
                    animation: {
                        'pulse-urgent': 'pulse-urgent 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        'pulse-urgent': {
                            '0%, 100%': { transform: 'scale(1)', boxShadow: '0 0 0 0 rgba(37, 211, 102, 0.7)' },
                            '50%': { transform: 'scale(1.05)', boxShadow: '0 0 0 15px rgba(37, 211, 102, 0)' },
                        },
                        'float': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .card-bg {
            background: linear-gradient(135deg, #0a0f1e 0%, #040712 100%);
        }

        .service-hover:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        .qr-placeholder {
            background-image: radial-gradient(circle, #1e293b 1px, transparent 1px);
            background-size: 10px 10px;
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 10px;
        }
    </style>
</head>

<body class="bg-[#02040a] text-slate-200 selection:bg-s4a-blue">

    <div class="min-h-screen flex flex-col items-center p-4 sm:p-6 lg:p-8">

        <!-- eCard Frame (Total Responsive & Mobile Optimized) -->
        <div
            class="w-full max-w-md lg:max-w-2xl card-bg border border-white/10 rounded-[40px] shadow-2xl overflow-hidden relative pb-10 transition-all duration-500">

            <!-- Top Branding Decoration -->
            <div class="h-32 bg-gradient-to-r from-s4a-blue to-s4a-navy flex items-start justify-end p-6">
                <span class="text-[10px] font-black tracking-[0.3em] text-white/40 uppercase">Sistemas 4A | 2026</span>
            </div>

            <!-- Profile Header -->
            <div class="px-8 -mt-16 flex flex-col items-center text-center">
                <div class="relative group mb-6">
                    <div
                        class="absolute -inset-2 bg-s4a-blue rounded-[40px] blur opacity-25 group-hover:opacity-100 transition duration-1000">
                    </div>
                    <img src="https://img.webme.com/pic/a/angelsoluciones/angelejecutivocopia.jpg" alt="Angel Rodriguez"
                        class="relative w-44 h-56 rounded-[35px] border-4 border-[#0a0f1e] object-cover shadow-2xl">
                    <div
                        class="absolute bottom-4 right-4 w-6 h-6 bg-s4a-accent border-4 border-[#0a0f1e] rounded-full animate-pulse">
                    </div>
                </div>

                <h1 class="font-display font-black text-2xl text-white tracking-tight">Ing. Angel Rodriguez</h1>
                <p class="text-s4a-blue font-bold text-xs uppercase tracking-widest mt-1 mb-4">Consultor de Sistemas &
                    IT</p>

                <p class="text-slate-400 text-sm leading-relaxed px-2">
                    Ingeniero de Sistemas especializado en infraestructura cr√≠tica, ciberseguridad corporativa y
                    automatizaci√≥n con IA.
                </p>

                <!-- NFC / QR Interaction Space -->
                <div class="mt-8 mb-4 w-full bg-white/5 border border-dashed border-white/20 rounded-3xl p-6 flex flex-col items-center group cursor-help"
                    title="Escanee este c√≥digo para guardar mi contacto instant√°neamente">
                    <div
                        class="w-72 h-72 bg-white rounded-[40px] flex items-center justify-center p-2 mb-4 shadow-2xl relative group overflow-hidden border-8 border-white/5">
                        <!-- C√ìDIGO QR REAL SISTEMAS 4A - TAMA√ëO MAXIMIZADO PARA ESCANEO -->
                        <img src="https://img.webme.com/pic/a/angelsoluciones/8XwL5d.png" alt="QR Sistemas 4A"
                            class="w-full h-full object-contain transition-transform duration-500 group-hover:scale-105">
                        <div
                            class="absolute inset-0 bg-s4a-blue/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                        </div>
                    </div>
                    <span class="text-[10px] font-black text-s4a-blue tracking-widest uppercase"><i
                            class="fas fa-bolt"></i> contacto r√°pido nfc / qr</span>
                </div>
            </div>

            <!-- Enhanced Services Section -->
            <div class="px-6 space-y-4 mt-4">
                <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.4em] px-2 mb-2">Servicios
                    Profesionales</h3>

                <!-- Servicio 1: Soporte -->
                <div onclick="openAI('soporte')"
                    class="w-full text-left glass-card border border-white/5 rounded-3xl p-5 hover:border-s4a-blue/50 transition-all group cursor-pointer active:scale-[0.98]">
                    <div class="flex items-center gap-4 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-s4a-blue/10 flex items-center justify-center text-s4a-blue">
                            <i class="fas fa-user-cog"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-white text-sm">Soporte T√©cnico (Popular)</h4>
                            <span class="text-[9px] text-s4a-accent font-bold uppercase">Disponibilidad 24/7</span>
                        </div>
                    </div>
                    <p class="text-[12px] text-slate-400 leading-relaxed mb-4">
                        Resoluci√≥n de incidencias y mantenimiento preventivo. Incluye <strong>Outsourcing IT
                            Integral</strong> para delegar su tecnolog√≠a, gesti√≥n del puesto de trabajo y protocolos de
                        **Continuidad Operativa** para evitar paradas cr√≠ticas.
                    </p>
                    <button
                        class="text-[10px] font-black text-s4a-blue border border-s4a-blue/20 px-4 py-2 rounded-xl uppercase flex items-center gap-2 group-hover:bg-s4a-blue group-hover:text-white transition-all">
                        Iniciar Diagn√≥stico <i class="fas fa-robot text-[8px]"></i>
                    </button>
                </div>

                <!-- Servicio 2: Infraestructura -->
                <div onclick="openAI('infra')"
                    class="w-full text-left glass-card border border-white/5 rounded-3xl p-5 hover:border-s4a-blue/50 transition-all group cursor-pointer active:scale-[0.98]">
                    <div class="flex items-center gap-4 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center text-s4a-blue">
                            <i class="fas fa-server"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-white text-sm">Infraestructura Cr√≠tica</h4>
                            <span class="text-[9px] text-s4a-blue font-bold uppercase">Arquitectura Senior</span>
                        </div>
                    </div>
                    <p class="text-[12px] text-slate-400 leading-relaxed mb-4">
                        La base vital de su rentabilidad. Dise√±o de <strong>Data Centers y Networking</strong> avanzados
                        con Alta Disponibilidad (Wintel/Azure). Infraestructuras 100% <strong>escalables</strong> que
                        crecen con su demanda de negocio.
                    </p>
                    <button
                        class="text-[10px] font-black text-s4a-blue border border-s4a-blue/20 px-4 py-2 rounded-xl uppercase flex items-center gap-2 group-hover:bg-s4a-blue group-hover:text-white transition-all">
                        Consultar Arquitectura <i class="fas fa-robot text-[8px]"></i>
                    </button>
                </div>

                <!-- Servicio 3: Ciberseguridad -->
                <div onclick="openAI('cyber')"
                    class="w-full text-left glass-card border border-white/5 rounded-3xl p-5 hover:border-s4a-blue/50 transition-all group cursor-pointer active:scale-[0.98]">
                    <div class="flex items-center gap-4 mb-3">
                        <div
                            class="w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center text-s4a-accent">
                            <i class="fas fa-shield-halved"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-white text-sm">Ciberseguridad 360¬∞</h4>
                            <span class="text-[9px] text-s4a-accent font-bold uppercase">ISO 27001 Standard</span>
                        </div>
                    </div>
                    <p class="text-[12px] text-slate-400 leading-relaxed mb-4">
                        Blindaje total contra <strong>Ransomware</strong>. Auditor√≠as exhaustivas bajo est√°ndares
                        internacionales y <strong>Monitoreo SOC</strong> constante para detectar amenazas en tiempo real
                        antes de que afecten su capital.
                    </p>
                    <button
                        class="text-[10px] font-black text-s4a-accent border border-s4a-accent/20 px-4 py-2 rounded-xl uppercase flex items-center gap-2 group-hover:bg-s4a-accent group-hover:text-black transition-all">
                        Blindaje Preventivo <i class="fas fa-robot text-[8px]"></i>
                    </button>
                </div>

                <!-- Servicio 4: Automatizaci√≥n IA -->
                <div onclick="openAI('ia')"
                    class="w-full text-left glass-card border border-white/5 rounded-3xl p-5 hover:border-s4a-blue/50 transition-all group cursor-pointer active:scale-[0.98]">
                    <div class="flex items-center gap-4 mb-3">
                        <div
                            class="w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-white text-sm">Automatizaci√≥n IA</h4>
                            <span class="text-[9px] text-purple-400 font-bold uppercase">Innovaci√≥n Cognitiva</span>
                        </div>
                    </div>
                    <p class="text-[12px] text-slate-400 leading-relaxed mb-4">
                        Optimizaci√≥n extrema mediante <strong>Agentes Inteligentes</strong> y RPA. Implementamos robots
                        que ejecutan tareas repetitivas y ofrecemos <strong>Consultor√≠a T√©cnica IA</strong> para
                        integrar la eficiencia del futuro hoy.
                    </p>
                    <button
                        class="text-[10px] font-black text-purple-400 border border-purple-400/20 px-4 py-2 rounded-xl uppercase flex items-center gap-2 group-hover:bg-purple-500 group-hover:text-white transition-all">
                        Optimizar con IA <i class="fas fa-robot text-[8px]"></i>
                    </button>
                </div>
            </div>

            <!-- Contact Actions -->
            <div class="px-6 mt-8 space-y-3">
                <a href="https://wa.me/584120317421"
                    class="w-full py-5 bg-[#25d366] text-black font-black text-base rounded-2xl flex items-center justify-center gap-3 animate-pulse-urgent shadow-lg shadow-green-500/20">
                    <i class="fab fa-whatsapp text-xl"></i> CONTACTAR POR WHATSAPP
                </a>

                <div class="grid grid-cols-2 gap-3">
                    <a href="mailto:nautiluz90@gmail.com"
                        class="py-4 glass-card border border-white/5 rounded-2xl flex flex-col items-center justify-center gap-1 hover:bg-white/5">
                        <i class="fas fa-envelope text-s4a-blue"></i>
                        <span class="text-[10px] font-black uppercase">Email</span>
                    </a>
                    <a href="tel:+584120317421"
                        class="py-4 glass-card border border-white/5 rounded-2xl flex flex-col items-center justify-center gap-1 hover:bg-white/5">
                        <i class="fas fa-phone-flip text-s4a-accent"></i>
                        <span class="text-[10px] font-black uppercase">Llamar</span>
                    </a>
                </div>
            </div>

            <!-- Meta Footer -->
            <div class="text-center mt-10">
                <p class="text-[10px] text-slate-600 font-bold uppercase tracking-[0.2em] mb-2">Ing. Angel Rodriguez |
                    Sistemas 4A</p>
                <div class="flex justify-center gap-4 text-slate-600">
                    <i class="fab fa-linkedin hover:text-white cursor-pointer transition-colors"></i>
                    <i class="fab fa-instagram hover:text-white cursor-pointer transition-colors"></i>
                </div>
            </div>
        </div>

        <!-- Bottom Tag -->
        <p class="mt-8 text-[10px] text-slate-700 font-bold uppercase tracking-widest">Digital Business Card | Propiedad
            de Sistemas 4A</p>
    </div>

    <!-- IA Copilot Modal (Guided Process) -->
    <div id="ia-modal"
        class="fixed inset-0 z-[150] bg-s4a-navy/95 backdrop-blur-3xl flex items-center justify-center p-4 hidden">
        <div
            class="bg-s4a-navy border border-white/5 w-full max-w-xl rounded-[40px] shadow-2xl overflow-hidden relative">
            <button onclick="closeAI()"
                class="absolute top-6 right-6 text-slate-500 hover:text-white transition-colors z-50">
                <i class="fas fa-times text-xl"></i>
            </button>

            <!-- Modal Header -->
            <div class="p-8 border-b border-white/5 bg-gradient-to-br from-blue-500/5 to-purple-500/5">
                <div class="flex items-center gap-4 mb-2">
                    <div
                        class="w-12 h-12 rounded-xl bg-s4a-blue flex items-center justify-center text-white shadow-lg shadow-blue-500/20">
                        <i class="fas fa-robot text-xl"></i>
                    </div>
                    <div>
                        <h2 class="font-display font-extrabold text-2xl text-white" id="ia-label">Copiloto T√©cnico 4A
                        </h2>
                        <p class="text-s4a-blue text-[10px] font-black uppercase tracking-[0.2em]">Gu√≠a de Soluciones
                            Inteligentes</p>
                    </div>
                </div>
            </div>

            <div class="p-8 space-y-6 max-h-[70vh] overflow-y-auto custom-scrollbar">

                <!-- STEP 1: DETALLE DEL SERVICIO (VERDE NE√ìN) -->
                <div id="ia-step-1" class="space-y-4 text-center sm:text-left">
                    <div
                        class="bg-emerald-500 rounded-3xl p-6 border-4 border-white shadow-[0_0_30px_rgba(16,185,129,0.5)]">
                        <h4 class="text-black font-black uppercase text-sm tracking-[0.3em] mb-3 text-center">
                            üü¢ PASO 1: ALCANCE PROFESIONAL</h4>
                        <div id="ia-service-full-desc"
                            class="text-black text-base leading-relaxed space-y-2 text-justify font-extrabold">
                            <!-- Inyectado por JS -->
                        </div>
                    </div>
                    <div class="p-5 bg-white rounded-2xl border-4 border-emerald-500 flex items-start gap-4 shadow-2xl">
                        <div
                            class="w-12 h-12 rounded-full bg-emerald-500 flex items-center justify-center shrink-0 shadow-lg border-2 border-black">
                            <i class="fas fa-eye text-black text-xl"></i>
                        </div>
                        <p class="text-[15px] text-black font-black leading-tight">
                            <span
                                class="bg-black text-emerald-400 px-2 py-0.5 rounded text-[10px] inline-block mb-1">INSTRUCCI√ìN
                                OBLIGATORIA</span><br>
                            Revise el alcance del servicio. Si es lo que busca, presione el bot√≥n para iniciar el
                            diagn√≥stico con Angel Rodriguez.
                        </p>
                    </div>
                    <button onclick="goToStep(2)"
                        class="w-full bg-emerald-500 py-6 rounded-2xl font-black text-xl uppercase tracking-widest hover:bg-emerald-400 text-black transition-all flex items-center justify-center gap-3 shadow-[0_10px_40px_rgba(16,185,129,0.4)] active:scale-95 border-b-8 border-emerald-700">
                        ACEPTAR E INICIAR <i class="fas fa-play"></i>
                    </button>
                </div>

                <!-- STEP 2: CONSULTA (AMARILLO TR√ÅFICO) -->
                <div id="ia-step-2" class="hidden space-y-6">
                    <div
                        class="p-5 bg-yellow-400 rounded-3xl border-4 border-white flex items-start gap-4 shadow-[0_0_30px_rgba(250,204,21,0.4)]">
                        <div
                            class="w-12 h-12 rounded-full bg-black flex items-center justify-center shrink-0 shadow-lg">
                            <i class="fas fa-edit text-yellow-400 text-xl"></i>
                        </div>
                        <p class="text-[15px] text-black font-black leading-tight">
                            <span class="bg-black text-yellow-400 px-2 py-0.5 rounded text-[10px] inline-block mb-1">üü°
                                PASO 2: DIAGN√ìSTICO</span><br>
                            Escriba su reporte, use la c√°mara y deje su contacto. No deje campos vac√≠os para un an√°lisis
                            preciso.
                        </p>
                    </div>
                    <div class="space-y-5">
                        <div class="group">
                            <label
                                class="text-sm font-black text-yellow-500 uppercase tracking-widest mb-2 block group-focus-within:text-white transition-colors">
                                1. DETALLE DEL PROBLEMA:</label>
                            <textarea id="ia-prompt"
                                class="w-full bg-white border-4 border-yellow-500 rounded-2xl p-5 text-black text-lg font-black outline-none focus:ring-8 focus:ring-yellow-500/20 transition-all resize-none placeholder:text-slate-400 h-32 relative z-[160] shadow-2xl"
                                placeholder="Describa su aver√≠a aqu√≠..."></textarea>
                        </div>

                        <!-- M√≥dulo de C√°mara -->
                        <div class="p-5 bg-white rounded-3xl border-4 border-yellow-500 shadow-2xl">
                            <label class="text-xs font-black text-black uppercase tracking-widest mb-3 block italic">
                                2. CAPTURAR EVIDENCIA (OPCIONAL):</label>
                            <div class="flex items-center gap-4">
                                <button onclick="document.getElementById('file-input').click()"
                                    class="flex-1 py-4 bg-black rounded-2xl text-xs font-black text-yellow-400 uppercase tracking-[0.2em] hover:bg-slate-800 transition-all flex items-center justify-center gap-3 shadow-lg active:scale-95 border-b-4 border-slate-700">
                                    <i class="fas fa-camera"></i> ACTIVAR C√ÅMARA
                                </button>
                                <input type="file" id="file-input" accept="image/*" capture="environment" class="hidden"
                                    onchange="handleImage(this)">
                                <div id="img-preview"
                                    class="w-20 h-20 bg-black rounded-xl hidden border-4 border-yellow-500 p-0.5 overflow-hidden shadow-2xl">
                                    <img src="" id="preview-src" class="w-full h-full object-cover rounded-lg">
                                </div>
                            </div>
                        </div>

                        <div class="group">
                            <label
                                class="text-sm font-black text-yellow-500 uppercase tracking-widest mb-2 block group-focus-within:text-white transition-colors italic">
                                3. SU NOMBRE Y CONTACTO:</label>
                            <input type="text" id="ia-contact-info"
                                class="w-full bg-white border-4 border-yellow-500 rounded-2xl p-5 text-black text-lg font-black outline-none focus:ring-8 focus:ring-yellow-500/20 transition-all relative z-[160] shadow-2xl"
                                placeholder="Ej: Angel 0412-0317421">
                        </div>
                    </div>

                    <button onclick="analyzeIA()" id="ia-btn"
                        class="w-full bg-yellow-400 py-6 rounded-2xl font-black text-xl text-black flex items-center justify-center gap-4 group hover:scale-[1.02] transition-all shadow-[0_15px_40px_rgba(250,204,21,0.3)] border-b-8 border-yellow-600">
                        GENERAR REPORTE IA <i class="fas fa-bolt-lightning text-black"></i>
                    </button>
                    <button onclick="goToStep(1)"
                        class="w-full text-white text-[12px] font-black uppercase tracking-widest hover:text-yellow-400 transition-colors py-2">‚Üê
                        VOLVER AL ALCANCE</button>
                </div>

                <!-- STEP 3: RESULTADO -->
                <div id="ia-step-3" class="hidden space-y-6 animate-fadeIn">
                    <div class="bg-slate-900/40 rounded-[32px] p-8 border-l-4 border-s4a-gold shadow-inner"
                        id="ia-result">
                        <!-- JS injects here -->
                    </div>

                    <div class="p-4 bg-emerald-500/5 rounded-2xl border border-emerald-500/20 text-center">
                        <p class="text-[11px] text-slate-400 leading-relaxed font-semibold">
                            ‚ö†Ô∏è Presione el bot√≥n inferior para enviar el diagn√≥stico y la evidencia visual directamente
                            a la consola de Angel Rodriguez.
                        </p>
                    </div>

                    <a id="wa-final-link" href="#"
                        class="w-full bg-s4a-accent py-5 rounded-2xl font-black text-lg text-black flex items-center justify-center gap-3 hover:scale-[1.02] transition-transform shadow-lg shadow-emerald-500/20">
                        <i class="fab fa-whatsapp text-2xl"></i> CONFIRMAR POR WHATSAPP
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts de L√≥gica Gu√≠ada & IA -->
    <script>
        let activeContext = 'general';
        const contextData = {
            soporte: {
                title: 'Soporte T\u00e9cnico (PC/Server)',
                fullDesc: 'Diagn\u00f3stico de hardware, fallas de encendido, lentitud extrema o errores de Windows/BlueScreen.',
                wa: 'Soporte T\u00e9cnico'
            },
            infra: {
                title: 'Infraestructura Cr\u00edtica',
                fullDesc: 'Optimizaci\u00f3n de Datacenters, Racks, Cableado Estructurado y Sistemas de Respaldo de Energ\u00eda.',
                wa: 'Infraestructura'
            },
            cyber: {
                title: 'Ciberseguridad y Redes',
                fullDesc: 'Protecci\u00f3n contra ataques, configuraci\u00f3n de Firewalls, VPNs y Auditor\u00edas de Seguridad IT.',
                wa: 'Ciberseguridad'
            },
            ia: {
                title: 'Automatizaci\u00f3n con IA',
                fullDesc: 'Implementaci\u00f3n de Agentes Inteligentes, Chatbots y Automatizaci\u00f3n de Procesos de Negocio.',
                wa: 'Automatizaci\u00f3n IA'
            }
        };

        // L√≥gica de Imagen / C√°mara
        let hasImage = false;
        function handleImage(input) {
            if (input.files && input.files[0]) {
                hasImage = true;
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('preview-src').src = e.target.result;
                    document.getElementById('img-preview').classList.remove('hidden');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function openAI(context) {
            activeContext = context;
            document.getElementById('ia-label').innerText = contextData[context].title;
            document.getElementById('ia-service-full-desc').innerHTML = contextData[context].fullDesc;

            document.getElementById('ia-modal').classList.remove('hidden');
            goToStep(1);

            // Limpiar campos y estado de imagen
            document.getElementById('ia-prompt').value = "";
            document.getElementById('ia-contact-info').value = "";
            document.getElementById('img-preview').classList.add('hidden');
            hasImage = false;
            document.body.style.overflow = 'hidden';
        }

        function goToStep(step) {
            document.getElementById('ia-step-1').classList.add('hidden');
            document.getElementById('ia-step-2').classList.add('hidden');
            document.getElementById('ia-step-3').classList.add('hidden');
            document.getElementById('ia-step-' + step).classList.remove('hidden');

            // Asegurar que el scroll del modal vuelva arriba en cada paso
            document.querySelector('#ia-modal .overflow-y-auto').scrollTop = 0;

            // Foco autom√°tico en campos para asegurar que se pueda escribir
            if (step === 2) {
                setTimeout(() => {
                    document.getElementById('ia-prompt').focus();
                }, 300);
            }
        }

        function closeAI() {
            document.getElementById('ia-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // CONFIGURACI\u00d3N IA REAL (GEMINI) - Sistemas 4A v3.1 (Executive Fix)
        const GEMINI_API_KEY = 'AIzaSyCCzF2wChwW3hTdq5B2k7IDZen4LTk1OXM';

        async function callGemini(contents) {
            const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY.trim()}`;

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: contents,
                        generationConfig: {
                            maxOutputTokens: 1000,
                            temperature: 0.2
                        }
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                return data;
            } catch (err) {
                console.error("Gemini API Error:", err.message);
                return null;
            }
        }

        async function analyzeIA() {
            const promptInput = document.getElementById('ia-prompt').value.trim();
            const contact = document.getElementById('ia-contact-info').value.trim();
            const btn = document.getElementById('ia-btn');
            const resultBox = document.getElementById('ia-result');

            if (!promptInput || !contact) {
                alert("ALERTA: Por favor describa el problema y deje su contacto.");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-microchip fa-spin"></i> PROCESANDO AN\u00c1LISIS SENIOR...';

            const sysPrompt = `Eres el Ing. Angel Rodriguez de Sistemas 4A, un Consultor IT Senior.
            CONTEXTO DEL SERVICIO: ${contextData[activeContext].title}.
            OBJETIVO: Diagn\u00f3stico t\u00e9cnico ejecutivo y preciso.
            INQUIETUD DEL CLIENTE: "${promptInput}".
            ${hasImage ? "IMPORTANTE: Analiza la IMAGEN adjunta. Si es una falla de Sistema Operativo, Pantallazo Azul o Hardware, identif\u00edcalo exactamente. Menciona lo que observas en la imagen en tu RAZONAMIENTO." : "Sin imagen."}
            
            ESTRUCTURA (Responde directo, ejecutivo, sin negritas):
            RAZONAMIENTO: (An\u00e1lisis detallado de la causa ra\u00edz y hallazgos en imagen)
            TIPS: (3 pasos avanzados de resoluci\u00f3n t\u00e9cnica)
            SLA: (Menciona tiempos de atenci\u00f3n 15-60 min remoto)
            FINAL: (Acci\u00f3n breve para WhatsApp)`;

            let contents = [{ parts: [{ text: sysPrompt }] }];
            if (hasImage) {
                try {
                    const src = document.getElementById('preview-src').src;
                    const mimeType = src.split(';')[0].split(':')[1];
                    const base64Data = src.split(',')[1];
                    contents[0].parts.push({
                        inline_data: { mime_type: mimeType, data: base64Data }
                    });
                } catch (e) { console.error("Error imagen:", e); }
            }

            const data = await callGemini(contents);
            let aiText = "";

            if (data && data.candidates && data.candidates[0].content) {
                aiText = data.candidates[0].content.parts[0].text;
            } else {
                console.warn("Fallback por error de API - Sistemas 4A.");
                let fbReason = "Se ha detectado una inconsistencia cr\u00edtica que requiere escalamiento de Nivel 3.";
                if (activeContext === 'soporte') fbReason = "Se ha detectado una degradaci\u00f3n en la integridad del Sistema Operativo o Hardware que compromete la estabilidad del equipo.";
                else if (activeContext === 'infra') fbReason = "Se ha detectado una anomal\u00eda en la infraestructura de servidores que requiere intervenci\u00f3n en sitio.";
                else if (activeContext === 'cyber') fbReason = "Se ha detectado un comportamiento an\u00f3malo que activa el protocolo de blindaje preventivo.";

                aiText = `RAZONAMIENTO: ${fbReason}\nTIPS: 1. Reinicie el equipo. 2. Documente el error. 3. Aguarde contacto especializado.\nSLA: 15-60 min remoto.\nFINAL: Procediendo con escalamiento ejecutivo inmediato por Angel Rodriguez.`;
            }

            const getSection = (key, boundary) => {
                const regex = new RegExp(`${key}:([\\s\\S]*?)(?=${boundary}|$)`, 'i');
                const match = aiText.match(regex);
                return match ? match[1].trim() : "An\u00e1lisis en curso.";
            };

            const reasoning = getSection('RAZONAMIENTO', 'TIPS');
            const tips = getSection('TIPS', 'SLA');
            const slaText = getSection('SLA', 'FINAL');
            const fin = getSection('FINAL', '__FIN__');

            resultBox.innerHTML = `
                <div class="space-y-4 animate-fadeIn">
                    <div class="border-l-4 border-s4a-blue pl-4">
                        <h5 class="text-s4a-blue text-[9px] font-black uppercase tracking-widest mb-1">Diagn\u00f3stico Senior v3.2</h5>
                        <p class="text-slate-100 text-sm leading-relaxed">${reasoning}</p>
                    </div>
                    <div class="bg-blue-600/5 p-4 rounded-2xl border border-blue-500/10">
                        <h5 class="text-s4a-accent text-[9px] font-black uppercase tracking-widest mb-1">Pasos de Resoluci\u00f3n</h5>
                        <p class="text-slate-300 text-xs italic">${tips}</p>
                    </div>
                </div>
            `;

            goToStep(3);

            // REPORTE CONFIGURADO PARA WHATSAPP (Ajuste Ejecutivo Final)
            let report = "SISTEMAS 4A | REPORTE T\u00c9CNICO SENIOR\n\n";
            report += `* CLIENTE: ${contact}\n`;
            report += `* SERVICIO: ${contextData[activeContext].wa}\n`;
            report += `* INQUIETUD: ${promptInput}\n\n`;
            report += `* DIAGN\u00d3STICO: ${reasoning}\n\n`;
            report += `* COPILOTO IA: ${fin}\n`;
            report += `* SLA: ${slaText}`;

            document.getElementById('wa-final-link').href = "https://wa.me/584120317421?text=" + encodeURIComponent(report);

            btn.disabled = false;
            btn.innerHTML = 'GENERAR REPORTE IA <i class="fas fa-bolt-lightning"></i>';
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log("Sistemas 4A: Motor IA Profesional v3.1 ACTIVO.");
        });
    </script>

    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 10px;
        }
    </style>
</body>

</html>
